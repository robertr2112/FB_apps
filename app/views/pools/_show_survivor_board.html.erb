<div id="survivor-board" class="table-responsive">
<table class="table table-striped table-bordered table-condensed table-hover">
  <tr>
    <td></td>
    <% @season.weeks.order(:week_number).each do |week| %>
      <td class="entry-header">
        <%= "Week #{week.week_number}" %>
      </td>
    <% end %>
  </tr>
  <% teams = Team.all.where(nfl: true) %>
  <% entries = @pool.entries.sort_by {|entry| [entry[:survivorStatusIn] ? 0 : 1,entry[:name]] } %>
  <% entries.each do |entry| %>
    <% entryOut = false %>
    <tr>
      <% if entry.entryStatusGood? %>
        <td class="entry-name"><%= entry.name %></td>
      <% else %>
        <td class="entry-error"><%= entry.name %></td>
      <% end %>
      <% @season.weeks.order(:week_number).each do |week| %>
        <% @picks = entry.picks.where(week_number: week.week_number) %>
        <% if @picks.empty? %> 
          <% if week.checkStateClosed || week.checkStateFinal ||
                !entry.entryStatusGood? %>
            <% if entryOut %>
              <td class="entry-out">XXX</td>
            <% else %>
              <td class="entry-out">Out</td>
              <% entryOut = true %>
            <% end %>
          <% else %>
            <td class="entry-blank"></td>
          <% end %>
        <% else %>
          <% @picks.each do |pick| %>
            <% game_pick = pick.game_picks.first %>
            <% team_nickname = 
                    teams[game_pick.chosenTeamIndex-1].name.split(" ").last %>
            <% if week.checkStateOpen %>
              <td></td>
            <% else %>
              <% if !week.checkStateFinal %>
                <td class="entry-base"><%= team_nickname %></td>
              <% else %>
                <% gameWon = false %>
                <% week.games.each do |game| %>
                  <% if game.wonGame?(game_pick.chosenTeamIndex) %>
                    <% gameWon = true %>
                  <% end %>
                <% end %>
                <% if gameWon %>
                  <td class="entry-success"><%= team_nickname %></td>
                <% else %>
                  <td class="entry-error"><%= team_nickname %></td>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    </tr>
  <% end %>
</table>
<% if (@season.current_week == @season.number_of_weeks) && @season.getCurrentWeek.checkStateFinal %>
  <% winners = Array.new %>
  <% @pool.entries.each do |entry| %>
    <% if entry.survivorStatusIn %>
      <% winners << entry %>
    <% end %>
  <% end %>
  <% if winners.count > 1 %>
    <p> The winners of the pool are:
  <% else %>
    <p> The winner of the pool is:
  <% end %>
  <% winners.each do |entry| %>
    <% user = User.find(entry.user_id) %>
    <i><%= "#{user.name} (#{entry.name})" %></i>
  <% end %>
<% end %>
</div>