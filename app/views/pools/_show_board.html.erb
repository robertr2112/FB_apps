<table class="table table-striped table-bordered table-condensed table-hover">
  <tr>
    <td></td>
    <% @season.weeks.order(:week_number).each do |week| %>
      <td class="entry-header">
        <%= "Week #{week.week_number}" %>
      </td>
    <% end %>
  </tr>
  <% teams = Team.all.where(nfl: true) %>
  <% @pool.entries.each do |entry| %>
    <% entryOut = false %>
    <tr>
      <% if entry.entryStatusGood? %>
        <td class="entry-name"><%= entry.name %></td>
      <% else %>
        <td class="entry-error"><%= entry.name %></td>
      <% end %>
      <% @season.weeks.order(:week_number).each do |week| %>
        <% @picks = week.picks.where(entry_id: entry.id) %>
        <% if @picks.empty? %> 
          <% if week.checkStateClosed || week.checkStateFinal ||
                !entry.entryStatusGood? %>
            <% if entryOut %>
              <td class="entry-out">XXX</td>
            <% else %>
              <td class="entry-out">Out</td>
              <% entryOut = true %>
            <% end %>
          <% else %>
            <td class="entry-blank"></td>
          <% end %>
        <% else %>
          <% @picks.each do |pick| %>
            <% game_pick = pick.game_picks.first %>
            <% team_nickname = 
                    teams[game_pick.chosenTeamIndex-1].name.split(" ").last %>
            <% if week.checkStateOpen %>
              <td></td>
            <% else %>
              <% if !week.checkStateFinal %>
                <td class="entry-base"><%= team_nickname %></td>
              <% else %>
                <% gameWon = false %>
                <% week.games.each do |game| %>
                  <% if game.wonGame?(game_pick.chosenTeamIndex) %>
                    <% gameWon = true %>
                  <% end %>
                <% end %>
                <% if gameWon %>
                  <td class="entry-success"><%= team_nickname %></td>
                <% else %>
                  <td class="entry-error"><%= team_nickname %></td>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    </tr>
  <% end %>
</table>
